local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local DayYield = {Keys = {}, ActiveKeys = {}, Windows = {}}

DayYield.Themes = {
	EldenTheme = {
		BackgroundColor = Color3.fromRGB(15, 15, 18),
		SidebarColor = Color3.fromRGB(10, 10, 12),
		AccentColor = Color3.fromRGB(180, 155, 95),
		TextColor = Color3.fromRGB(225, 220, 210),
		SubTextColor = Color3.fromRGB(160, 155, 145),
		ElementColor = Color3.fromRGB(25, 25, 30),
		BorderColor = Color3.fromRGB(45, 40, 35),
		NotificationColor = Color3.fromRGB(20, 20, 25),
		GoldAccent = Color3.fromRGB(205, 175, 115)
	}
}

DayYield.Style = table.clone(DayYield.Themes.EldenTheme)

-- Detect device type
local deviceType
if UserInputService.TouchEnabled then
	deviceType = "Mobile"
elseif UserInputService.GamepadEnabled then
	deviceType = "Console"
else
	deviceType = "Desktop"
end
print("Running on:", deviceType)

-- Auto-scaling function
local function scaleUI(element)
	local screenSize = workspace.CurrentCamera.ViewportSize
	if deviceType == "Mobile" then
		element.Size = UDim2.new(0.8, 0, 0.8, 0)
		element.Position = UDim2.new(0.1, 0, 0.1, 0)
	else
		element.Size = UDim2.new(0.4, 0, 0.6, 0)
		element.Position = UDim2.new(0.3, 0, 0.2, 0)
	end
end

-- CreateKeybind function
function DayYield:CreateKeybind(config)
	local keybind = {
		Key = config.Key or Enum.KeyCode.Unknown,
		Callback = config.Callback or function() end,
		Description = config.Description or "No description provided."
	}

	-- Store the keybind in the ActiveKeys table
	table.insert(DayYield.ActiveKeys, keybind)

	-- Listen for the key press
	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if gameProcessed then return end
		if input.KeyCode == keybind.Key then
			keybind.Callback()
		end
	end)

	return keybind
end

function DayYield:Notify(title, message, duration)
	duration = duration or 5

	local notification = Instance.new("Frame")
	notification.Size = UDim2.new(0, 300, 0, 60)
	notification.Position = UDim2.new(1, -320, 1, -80)
	notification.BackgroundColor3 = DayYield.Style.NotificationColor
	notification.BorderSizePixel = 0
	notification.Parent = PlayerGui

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 8)
	corner.Parent = notification

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Text = title
	titleLabel.Font = Enum.Font.GothamBold
	titleLabel.TextColor3 = DayYield.Style.GoldAccent
	titleLabel.TextSize = 14
	titleLabel.Size = UDim2.new(1, -20, 0, 20)
	titleLabel.Position = UDim2.new(0, 10, 0, 5)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Parent = notification

	local messageLabel = Instance.new("TextLabel")
	messageLabel.Text = message
	messageLabel.Font = Enum.Font.Gotham
	messageLabel.TextColor3 = DayYield.Style.TextColor
	messageLabel.TextSize = 12
	messageLabel.Size = UDim2.new(1, -20, 1, -30)
	messageLabel.Position = UDim2.new(0, 10, 0, 25)
	messageLabel.BackgroundTransparency = 1
	messageLabel.Parent = notification

	notification.Position = UDim2.new(1, -320, 1, 100)
	TweenService:Create(notification, TweenInfo.new(0.3), {
		Position = UDim2.new(1, -320, 1, -80)
	}):Play()

	task.delay(duration, function()
		TweenService:Create(notification, TweenInfo.new(0.3), {
			Position = UDim2.new(1, -320, 1, 100)
		}):Play()
		task.wait(0.3)
		notification:Destroy()
	end)
end

-- Loading Screen
local loadingScreen = Instance.new("ScreenGui")
loadingScreen.Name = "LoadingScreen"
loadingScreen.Parent = PlayerGui
loadingScreen.ResetOnSpawn = false

local loadingFrame = Instance.new("Frame")
loadingFrame.Size = UDim2.new(1, 0, 1, 0)
loadingFrame.BackgroundTransparency = 1
loadingFrame.Parent = loadingScreen

local loadingText = Instance.new("TextLabel")
loadingText.Text = "DayYield..."
loadingText.Font = Enum.Font.GothamBold
loadingText.TextColor3 = DayYield.Style.GoldAccent
loadingText.TextSize = 20
loadingText.Size = UDim2.new(1, 0, 0, 50)
loadingText.Position = UDim2.new(0, 0, 0.5, -25)
loadingText.BackgroundTransparency = 1
loadingText.Parent = loadingFrame

-- Rotate the text
local rotationSpeed = 1
local rotationConnection
rotationConnection = RunService.RenderStepped:Connect(function(deltaTime)
	loadingText.Rotation = loadingText.Rotation + rotationSpeed * deltaTime * 60
end)

-- Simulate loading
task.delay(2, function()
	rotationConnection:Disconnect()
	TweenService:Create(loadingText, TweenInfo.new(3), {
		TextTransparency = 1
	}):Play()
	task.wait(3)
	loadingScreen:Destroy()
end)

function DayYield:CreateWindow(config)
	local window = {}
	local gui = Instance.new("ScreenGui")
	local mainFrame = Instance.new("Frame")
	local titleBar = Instance.new("Frame")
	local sidebar = Instance.new("Frame")
	local decoration = Instance.new("Frame")
	local contentFrame = Instance.new("Frame")

	gui.Name = "DayYieldElden"
	gui.Parent = PlayerGui
	gui.ResetOnSpawn = false
	gui.Enabled = false -- Initially hidden

	-- Auto-scale the main frame
	scaleUI(mainFrame)
	mainFrame.BackgroundColor3 = DayYield.Style.BackgroundColor
	mainFrame.Parent = gui

	local mainBorder = Instance.new("UIStroke")
	mainBorder.Color = DayYield.Style.BorderColor
	mainBorder.Thickness = 1.5
	mainBorder.Parent = mainFrame

	titleBar.Name = "TitleBar"
	titleBar.Size = UDim2.new(1, 0, 0, 40)
	titleBar.BackgroundColor3 = DayYield.Style.SidebarColor
	titleBar.Parent = mainFrame

	local titleText = Instance.new("TextLabel")
	titleText.Text = config.Title or "DayYield"
	titleText.Font = Enum.Font.GothamBold
	titleText.TextColor3 = DayYield.Style.GoldAccent
	titleText.TextSize = 20
	titleText.Size = UDim2.new(1, 0, 1, 0)
	titleText.BackgroundTransparency = 1
	titleText.Parent = titleBar

	sidebar.Name = "Sidebar"
	sidebar.Size = UDim2.new(0, 220, 1, -40)
	sidebar.Position = UDim2.new(0, 0, 0, 40)
	sidebar.BackgroundColor3 = DayYield.Style.SidebarColor
	sidebar.Parent = mainFrame

	decoration.Name = "Decoration"
	decoration.Size = UDim2.new(1, 0, 0, 2)
	decoration.Position = UDim2.new(0, 0, 0, 0)
	decoration.BackgroundColor3 = DayYield.Style.GoldAccent
	decoration.Parent = sidebar

	local tabContainer = Instance.new("ScrollingFrame")
	tabContainer.Name = "TabContainer"
	tabContainer.Size = UDim2.new(1, -20, 1, -20)
	tabContainer.Position = UDim2.new(0, 10, 0, 10)
	tabContainer.BackgroundTransparency = 1
	tabContainer.ScrollBarThickness = 2
	tabContainer.ScrollBarImageColor3 = DayYield.Style.GoldAccent
	tabContainer.Parent = sidebar

	local tabList = Instance.new("UIListLayout")
	tabList.Parent = tabContainer
	tabList.SortOrder = Enum.SortOrder.LayoutOrder
	tabList.Padding = UDim.new(0, 8)

	contentFrame.Name = "ContentFrame"
	contentFrame.Size = UDim2.new(1, -240, 1, -60)
	contentFrame.Position = UDim2.new(0, 230, 0, 50)
	contentFrame.BackgroundTransparency = 1
	contentFrame.Parent = mainFrame

	local function createTabButton(name)
		local button = Instance.new("TextButton")
		button.Size = UDim2.new(1, 0, 0, 35)
		button.BackgroundColor3 = DayYield.Style.ElementColor
		button.Text = name
		button.TextColor3 = DayYield.Style.TextColor
		button.TextSize = 14
		button.Font = Enum.Font.GothamSemibold

		local buttonBorder = Instance.new("UIStroke")
		buttonBorder.Color = DayYield.Style.BorderColor
		buttonBorder.Thickness = 1
		buttonBorder.Parent = button

		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(0, 4)
		corner.Parent = button

		local padding = Instance.new("UIPadding")
		padding.PaddingLeft = UDim.new(0, 15)
		padding.Parent = button

		return button
	end

	function window:CreateTab(name)
		local tab = {}
		local tabButton = createTabButton(name)
		local tabContent = Instance.new("ScrollingFrame")

		tabButton.Parent = tabContainer

		tabContent.Name = name.."Content"
		tabContent.Size = UDim2.new(1, 0, 1, 0)
		tabContent.BackgroundTransparency = 1
		tabContent.ScrollBarThickness = 2
		tabContent.ScrollBarImageColor3 = DayYield.Style.GoldAccent
		tabContent.Visible = false
		tabContent.Parent = contentFrame

		local elementList = Instance.new("UIListLayout")
		elementList.Parent = tabContent
		elementList.SortOrder = Enum.SortOrder.LayoutOrder
		elementList.Padding = UDim.new(0, 10)

		local function createButton(config)
			local button = Instance.new("TextButton")
			button.Size = UDim2.new(1, -20, 0, 40)
			button.Position = UDim2.new(0, 10, 0, 0)
			button.BackgroundColor3 = DayYield.Style.ElementColor
			button.Text = config.Name
			button.TextColor3 = DayYield.Style.TextColor
			button.TextSize = 14
			button.Font = Enum.Font.GothamSemibold

			local buttonBorder = Instance.new("UIStroke")
			buttonBorder.Color = DayYield.Style.BorderColor
			buttonBorder.Thickness = 1
			buttonBorder.Parent = button

			local corner = Instance.new("UICorner")
			corner.CornerRadius = UDim.new(0, 4)
			corner.Parent = button

			button.MouseEnter:Connect(function()
				TweenService:Create(button, TweenInfo.new(0.2), {
					BackgroundColor3 = DayYield.Style.AccentColor
				}):Play()
			end)

			button.MouseLeave:Connect(function()
				TweenService:Create(button, TweenInfo.new(0.2), {
					BackgroundColor3 = DayYield.Style.ElementColor
				}):Play()
			end)

			return button
		end

		function tab:CreateButton(config)
			local button = createButton(config)
			button.Parent = tabContent

			button.MouseButton1Click:Connect(function()
				config.Callback()
			end)
		end

		function tab:CreateToggle(config)
			local toggleButton = createButton(config)
			toggleButton.Parent = tabContent

			local toggleState = false
			local indicator = Instance.new("Frame")
			indicator.Size = UDim2.new(0, 20, 0, 20)
			indicator.Position = UDim2.new(1, -30, 0.5, -10)
			indicator.BackgroundColor3 = DayYield.Style.ElementColor
			indicator.Parent = toggleButton

			local indicatorBorder = Instance.new("UIStroke")
			indicatorBorder.Color = DayYield.Style.BorderColor
			indicatorBorder.Thickness = 1
			indicatorBorder.Parent = indicator

			Instance.new("UICorner", indicator).CornerRadius = UDim.new(0, 4)

			toggleButton.MouseButton1Click:Connect(function()
				toggleState = not toggleState
				local targetColor = toggleState and DayYield.Style.GoldAccent or DayYield.Style.ElementColor
				TweenService:Create(indicator, TweenInfo.new(0.2), {
					BackgroundColor3 = targetColor
				}):Play()
				config.Callback(toggleState)
			end)
		end

		tabButton.MouseButton1Click:Connect(function()
			for _, child in ipairs(contentFrame:GetChildren()) do
				if child:IsA("ScrollingFrame") then
					child.Visible = false
				end
			end
			tabContent.Visible = true
		end)

		return tab
	end

	local dragging, dragInput, dragStart, startPos

	titleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = mainFrame.Position
		end
	end)

	titleBar.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
			local delta = input.Position - dragStart
			mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)

	Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 8)
	Instance.new("UICorner", titleBar).CornerRadius = UDim.new(0, 8)
	Instance.new("UICorner", sidebar).CornerRadius = UDim.new(0, 8)

	-- Keybind (K) to toggle UI
	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if gameProcessed then return end
		if input.KeyCode == Enum.KeyCode.K then
			gui.Enabled = not gui.Enabled
			TweenService:Create(mainFrame, TweenInfo.new(0.3), {
				Position = gui.Enabled and UDim2.new(0.3, 0, 0.2, 0) or UDim2.new(0.3, 0, -1, 0)
			}):Play()
		end
	end)

	return window
end

return DayYield
